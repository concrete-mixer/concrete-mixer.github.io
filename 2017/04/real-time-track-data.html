<!DOCTYPE html>
<html class="no-js">
  <head>
	<meta charset="utf-8">
	<title>
        
            Real time track data added to home page
        
    </title>
	<meta name="description" content="You should notice that there’s a “Now playing” section in the “hero image” on the home page which lists tracks currently playing in the Concrète Mixer audio ...">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- CSS -->
	<link rel="stylesheet" href="/css/main.css">

	<!--Favicon-->
	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

	<!-- Canonical -->
	<link rel="canonical" href="https://concrete-mixer.github.io/2017/04/real-time-track-data">

	<!-- RSS -->
	<link rel="alternate" type="application/atom+xml" title="Concrète Mixer - shredded field recording ambience" href="https://concrete-mixer.github.io/feed.xml" />

	<!-- Font Awesome -->
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

	<!-- Google Fonts -->
	
	<link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,700italic,400italic" rel="stylesheet" type="text/css">
	

	<!-- KaTeX -->
	
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min.css">
	<script src="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min.js"></script>
	

	<!-- Google Analytics -->
	
	<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-70881154-1', 'auto');
	ga('send', 'pageview');
	</script>
	

  <script src="https://cdn.jsdelivr.net/sockjs/1/sockjs.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <script src="https://connect.soundcloud.com/sdk/sdk-3.1.2.js"></script>
  <script>
    // heyho, it's jquery
    $(document).ready(function() {
      // do it like this for now
      contributor_sites = {
        'Adrien Capozzi': 'http://www.adrien75.com/adrien75.html',
        'Michael Upton':  'http://nonwrestler.com',
        'Rob Szeliga':    'http://www.rszoniq.com',
        'Sebastian Broc': 'http://bemtevi.de/'
      }

      // initialise soundcloud client
      SC.initialize({
        client_id: '11bab725274cff587d5908c18cd501c2'
      });

      // kick off sockJS connection
      var sock = new SockJS('http://concrete-mixer.venturus.io/cm-data');
      sock.onopen = function() {
        console.log('WS connection open');
      };

      sock.onmessage = function(e) {
        var data = JSON.parse(e.data)
        var id = '#stream' + data.stream
        var $el = $(id)

        if ( $el ) {
          $('.call-out').addClass('now-playing')

          $('#nowPlaying').fadeIn(500, function() {
            $el.fadeOut(500, function() {
              var contributorName = data.recordist

              if ( contributor_sites[data.recordist] !== undefined ) {
                contributorName = '<a href="'
                  + contributor_sites[data.recordist]
                  + '">' + data.recordist + '</a>'
              }

              if ( data.soundcloudTrackId ) {
                SC.get('/tracks/' + data.soundcloudTrackId)
                  .then(function(track) {
                    $el.html(
                      contributorName
                      + ': <a href="' + track.permalink_url
                      + '" target="_blank">' + data.file + '</a>'
                    )

                    $el.fadeIn(500)
                  });
              }
              else {
                $el.html(contributorName + ': ' + data.file);
                $el.fadeIn(500)
              }
            })
          })
        }
      };

      sock.onclose = function() {
        console.log('WS connection closed');
      };
    });
  </script>
</head>

  <body>
    <header class="site-header">
	<div class="branding">
		
		<a href="/">
			<img class="avatar" src="/img/highgate.jpg" alt=""/>
		</a>
		
		<h1 class="site-title">
			<a href="/">Concrète Mixer - shredded field recording ambience</a>
		</h1>
	</div>
	<nav class="site-nav">
		<ul>
			
			
			
			
			<li>
				<a class="page-link" href="/contributors">
					Concrète Mixer radio contributors
				</a>
			</li>
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			<!-- Social icons from Font Awesome, if enabled -->
			
<li>
	<a href="https://concrete-mixer.github.io/feed.xml" title="Follow RSS feed">
		<i class="fa fa-fw fa-rss"></i>
	</a>
</li>



<li>
	<a href="mailto:concretemixer.audio@gmail.com" title="Email">
		<i class="fa fa-fw fa-envelope"></i>
	</a>
</li>













<li>
	<a href="https://github.com/concrete-mixer" title="Follow on GitHub">
		<i class="fa fa-fw fa-github"></i>
	</a>
</li>













<li>
	<a href="https://soundcloud.com/concrete-mixer" title="Follow on SoundCloud">
		<i class="fa fa-fw fa-soundcloud"></i>
	</a>
</li>









<li>
	<a href="https://twitter.com/soundsconcrete" title="Follow on Twitter">
		<i class="fa fa-fw fa-twitter"></i>
	</a>
</li>






		</ul>
	</nav>
</header>

    <div class="content">
      <article class="feature-image">
  <header style="background-image: url('/img/concrete-feature.jpg')">
    <h1 class="title">Real time track data added to home page</h1>
    <p class="meta">
    April 30, 2017
    
    </p>
  </header>
  <section class="post-content"><p>You should notice that there’s a “Now playing” section in the “hero image” on the home page which lists tracks currently playing in the Concrète Mixer audio stream. I’ve achieved this by:</p>

<ul>
  <li>Adding extra <a href="http://opensoundcontrol.org">OSC</a> request calls to <code class="highlighter-rouge">playSound.ck</code> within Concrète Mixer, which broadcast the file name being played</li>
  <li>Adding a <a href="https://nodejs.org">nodejs</a> server which:
    <ul>
      <li>Listens for OSC notifications from <code class="highlighter-rouge">playSound.ck</code>, converting the file name into three parts:
        <ol>
          <li>Sound contributor</li>
          <li>Description of sound</li>
          <li>Soundcloud track ID (if available)</li>
        </ol>
      </li>
      <li>Broadcasts the data to connected browsers via websockets (or other appropriate technology via <a href="https://github.com/sockjs">sock.js</a>)</li>
    </ul>
  </li>
  <li>Added <a href="https://www.nginx.com">nginx</a> to proxy both the node server and the mp3 stream to downstream consumers</li>
  <li>Adding javascript (humble <a href="https://jquery.com/">jQuery</a>) to the homepage which updates the text under the player when a new track is played.</li>
</ul>

<p>So far the Pi hasn’t taken on any extra load from these services (the bulk of the CPU usage lies - understandably - with chuck and darkice). Admittedly the Pi’s not serving many simultaneous connections. Still, what an awesome little machine, eh?</p>

<p>There’s more work that could be done: as the metadata is currently bundled into the filename it’s tempting to set up a database to keep track of the data at the node end, and simplify the file names to simple ids. The db would be built in sqlite or maybe one of those fancy nosql dbs I’ve hearing about. So many possibilities…</p>
</section>
</article>

<!-- Post navigation -->


<!-- Disqus -->

<div class="comments">
  <div id="disqus_thread"></div>
<script type="text/javascript">
	var disqus_shortname = 'concretemixer';
	(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

</div>


    </div>
    
<script src="/js/katex_init.js"></script>



<footer class="site-footer">
	<p class="text">Powered by <a href="http://jekyllrb.com">Jekyll</a> with <a href="https://rohanchandra.github.io/project/type/">Type Theme</a>
</p>
</footer>


  </body>
</html>
